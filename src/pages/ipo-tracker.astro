---
import BaseLayout from '../layouts/BaseLayout.astro';
import IPOTable from '../components/ipo-tracker/IPOTable';
import { ipoData, getUniqueSectors } from '../data/ipo-data';

const sectors = getUniqueSectors();
const totalMarketCap = (ipoData.summary_stats.total_market_cap / 1_000_000_000).toFixed(1);
---

<BaseLayout
  title="Saudi IPO Tracker"
  description="Complete database of Saudi Arabian IPOs with performance data. Track 19+ IPOs across 8 sectors from 2020-2025."
>
  <section class="section bg-alabaster">
    <div class="container">
      <!-- Page Header -->
      <div class="mb-8">
        <p class="label text-copper mb-2">Live Database</p>
        <h1 class="mb-3">Saudi IPO Tracker</h1>
        <p class="text-gray-600 max-w-2xl">
          Complete database of Saudi Arabian IPOs with performance data, valuation metrics, and in-depth analysis links. Updated regularly.
        </p>
        <p class="meta mt-2">
          Last Updated: {new Date(ipoData.metadata.last_updated).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
        </p>
      </div>

      <!-- Statistics Cards -->
      <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-10">
        <div class="card text-center py-5">
          <span class="font-data text-2xl font-bold text-sage block">{ipoData.metadata.total_ipos}</span>
          <span class="text-sm text-gray-500">Total IPOs</span>
        </div>
        <div class="card text-center py-5">
          <span class="font-data text-2xl font-bold text-sage block">SAR {totalMarketCap}B</span>
          <span class="text-sm text-gray-500">Total Market Cap</span>
        </div>
        <div class="card text-center py-5">
          <span class="font-data text-2xl font-bold text-sage block performance-positive">+{ipoData.summary_stats.average_return}%</span>
          <span class="text-sm text-gray-500">Avg. Return</span>
        </div>
        <div class="card text-center py-5">
          <span class="font-data text-2xl font-bold text-sage block">{sectors.length}</span>
          <span class="text-sm text-gray-500">Sectors</span>
        </div>
        <div class="card text-center py-5 col-span-2 lg:col-span-1">
          <span class="font-data text-lg font-bold text-copper block">{ipoData.summary_stats.best_performer.company}</span>
          <span class="text-sm text-gray-500">Top: +{ipoData.summary_stats.best_performer.return}%</span>
        </div>
      </div>

      <!-- Interactive IPO Table (React Island) -->
      <div class="card p-4 md:p-6">
        <IPOTable client:load data={ipoData.ipos} sectors={sectors} />
      </div>

      <div class="mt-6 p-4 bg-white border border-gray-200 rounded-lg">
        <p class="text-xs text-gray-600 m-0 leading-relaxed">
          IPO tracker entries are informational snapshots and may be delayed, incomplete, or revised. They should not be treated as real-time market data or investment recommendations.
        </p>
      </div>
    </div>
  </section>
</BaseLayout>
