---
const navLinks = [
  { href: '/case-studies', label: 'Case Studies' },
  { href: '/blog', label: 'Blog' },
  { href: '/ipo-tracker', label: 'IPO Tracker' },
  { href: '/about', label: 'About' },
  { href: '/legal/disclaimer', label: 'Disclaimer' },
];
---

<header class="bg-white border-b border-gray-200">
  <div class="container py-4 flex items-center justify-between gap-4 relative">
    <a href="/" class="font-heading text-2xl font-bold text-graphite no-underline">
      decoded<span class="text-sage">.</span>finance
    </a>

    <nav aria-label="Primary" class="hidden md:block">
      <ul class="list-none m-0 p-0 flex items-center gap-5">
        {navLinks.map((link) => (
          <li>
            <a href={link.href} class="text-sm text-gray-600 hover:text-sage no-underline transition-colors">
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <div class="hidden md:block">
      <a href="https://www.linkedin.com/in/abdulgaffarcfa/" target="_blank" rel="noopener noreferrer" class="btn-primary text-sm py-2 px-4">LinkedIn</a>
    </div>

    <button
      type="button"
      class="mobile-menu-button md:hidden"
      aria-expanded="false"
      aria-controls="mobile-primary-nav"
      aria-label="Open navigation menu"
      data-mobile-nav-toggle
    >
      <span aria-hidden="true">â˜°</span>
    </button>
  </div>

  <nav id="mobile-primary-nav" aria-label="Mobile primary" class="mobile-nav-panel md:hidden" hidden data-mobile-nav>
    <div class="container py-4">
      <ul class="list-none m-0 p-0 flex flex-col gap-2">
        {navLinks.map((link) => (
          <li>
            <a href={link.href} class="mobile-nav-link">
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <a
        href="https://www.linkedin.com/in/abdulgaffarcfa/"
        target="_blank"
        rel="noopener noreferrer"
        class="btn-primary text-sm py-2 px-4 mt-4"
      >
        LinkedIn
      </a>
    </div>
  </nav>
</header>

<script>
  const toggle = document.querySelector('[data-mobile-nav-toggle]');
  const panel = document.querySelector('[data-mobile-nav]');

  if (toggle instanceof HTMLButtonElement && panel instanceof HTMLElement) {
    const closeNav = (shouldFocusToggle = true) => {
      toggle.setAttribute('aria-expanded', 'false');
      toggle.setAttribute('aria-label', 'Open navigation menu');
      panel.hidden = true;
      document.body.classList.remove('mobile-nav-open');
      if (shouldFocusToggle) toggle.focus();
    };

    const openNav = () => {
      toggle.setAttribute('aria-expanded', 'true');
      toggle.setAttribute('aria-label', 'Close navigation menu');
      panel.hidden = false;
      document.body.classList.add('mobile-nav-open');
      const firstLink = panel.querySelector('a');
      if (firstLink instanceof HTMLElement) firstLink.focus();
    };

    const setOpen = (isOpen, shouldFocusToggle = true) => (isOpen ? openNav() : closeNav(shouldFocusToggle));

    setOpen(false, false);

    toggle.addEventListener('click', () => {
      const isOpen = toggle.getAttribute('aria-expanded') === 'true';
      setOpen(!isOpen);
    });

    panel.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => setOpen(false, false));
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && toggle.getAttribute('aria-expanded') === 'true') {
        closeNav();
      }
    });

    document.addEventListener('click', (event) => {
      const isOpen = toggle.getAttribute('aria-expanded') === 'true';
      if (!isOpen) return;
      const target = event.target;
      if (target instanceof Node && !panel.contains(target) && !toggle.contains(target)) {
        setOpen(false, false);
      }
    });

    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768 && toggle.getAttribute('aria-expanded') === 'true') {
        setOpen(false, false);
      }
    });
  }
</script>
